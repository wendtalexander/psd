---
title: Ornstein-Uhlenbeck
---

## 1. Motivation

Here to perform a simple power spectrum analysis, with the ornstein uhlenbeck process.
This differential equation is nice, because there is analytical solution for the power spectrum.
With this one can calibrate different methods for calculating power spectra.

This scirpt follows the book chapter "A Brief Introduction to Some Simple
Stochastic Processes" from Benjamin Linder [doi](https://doi.org/10.1093/acprof:oso/9780199235070.003.0001)

Where you can find the probability density function of the OU process
 

$$
P(V,t) = \frac{1}{\sqrt{2\pi<\Delta v^2(t)>}} \exp{-\frac{(V- <v(t)>)^2}{2<\Delta v^2(t)>}}
$$ {#eq-prob}

where
$$ <v(t)> = v_0 e^{-\gamma t}  $$
and 
$$<\Delta v^2 (t)> = \frac{D}{\gamma}[1-e^{-2\gamma t}]$$

And the power spectrum is defined as:

$$ S(f) = \frac{2D}{\gamma^2 + (2 \pi f)^2} $$ {#eq-power}

```{python}
import jax
import jax.numpy as jnp
import jax.scipy as jsp
import jaxon.models.ou as ou

key = jax.random.PRNGKey(42)
fs = 30_000
nperseg = 2**16
duration = 10

gamma = 1
noise_strength = 0.1
theory_color = "magenta"
time = jnp.arange(0, duration, 1 / fs)
params = ou.OUParams(fs=fs, gamma=gamma, noise_strength=noise_strength)
v = ou.simulate(key, duration, params)
```

```{python}
# | output: false
import plotly.graph_objects as go

fig = go.Figure()
fig.add_scattergl(x=time, y=v, mode="lines", name="V")
```
```{python}
# | echo: false
# | renderings: [light, dark]
fig.update_layout(template="plotly_white")
display(fig)
fig.update_layout(template="plotly_dark")
display(fig)
```

## 2. Implementation of probability density function
```{python}

# | output: false
def psd_oe(time, V, gamma, noise_strength):
    delta_vt = (noise_strength / gamma) * (1 - jnp.exp(-2 * gamma * time))
    vt = jnp.exp(-gamma * time)
    theory = (1 / jnp.sqrt(2 * jnp.pi * delta_vt)) * jnp.exp(
        -((V - vt) ** 2) / (2 * delta_vt)
    )
    return theory


voltages = jnp.linspace(-1, 1, len(time))
theory = psd_oe(time, voltages, gamma, noise_strength)

fig = go.Figure()
fig.add_histogram(x=v, name="V", histnorm="probability density", nbinsx=50)
fig.add_scatter(
    x=voltages, y=theory, mode="lines", line_color=theory_color, name="Theory"
)
fig.update_layout(xaxis_title="Voltage", yaxis_title="Probabilty density")
```
```{python}
# | echo: false
# | renderings: [light, dark]
fig.update_layout(template="plotly_white")
display(fig)
fig.update_layout(template="plotly_dark")
display(fig)
```

